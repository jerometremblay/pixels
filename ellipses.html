<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ellipses</title>
    <style>
      :root {
        color-scheme: light;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        min-height: 100vh;
        background: #0f172a;
        font-family: "Space Grotesk", "Segoe UI", system-ui, sans-serif;
        color: #e2e8f0;
      }
      header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 36px;
        display: flex;
        align-items: center;
        padding: 0 16px;
        background: rgba(15, 23, 42, 0.85);
        border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        backdrop-filter: blur(8px);
        font-size: 0.85rem;
        z-index: 10;
      }
      header a {
        color: #cbd5f5;
        text-decoration: none;
      }
      header a:hover {
        color: #38bdf8;
      }
      .grid {
        width: 100vw;
        height: 100vh;
        display: grid;
        grid-template-columns: repeat(var(--cols), minmax(0, 1fr));
        grid-auto-rows: 1fr;
        gap: 2px;
        padding: 2px;
      }
      .hud {
        position: fixed;
        top: 52px;
        left: 16px;
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(148, 163, 184, 0.2);
        padding: 0.75rem 1rem;
        border-radius: 12px;
        font-size: 0.95rem;
        display: grid;
        gap: 0.5rem;
      }
      .hud label {
        display: grid;
        gap: 0.35rem;
        font-size: 0.85rem;
        color: #cbd5f5;
      }
      .hud input[type="range"] {
        width: 200px;
      }
    </style>
  </head>
  <body>
    <header>
      <a href="index.html">← Back to Pixels Lab</a>
    </header>
    <div class="hud">
      <div id="hud">Ellipses grid ready.</div>
      <label>
        Square size
        <input type="range" id="blockSize" min="8" max="48" step="0.25" value="14" />
      </label>
      <label>
        Line width
        <input type="range" id="lineWidth" min="0.5" max="5" step="0.1" value="3" />
      </label>
      <label>
        X axis
        <input type="range" id="axisX" min="0.2" max="1" step="0.02" value="0.7" />
      </label>
      <label>
        Y axis
        <input type="range" id="axisY" min="0.2" max="1" step="0.02" value="0.7" />
      </label>
    </div>
    <svg class="grid" id="grid" aria-label="Pixel grid" role="img"></svg>

    <script src="pixels.js"></script>
    <script>
      const axisXInput = document.getElementById("axisX");
      const axisYInput = document.getElementById("axisY");

      const lineWidthInput = document.getElementById("lineWidth");

      Pixels.initPixelGrid({
        blockSizeId: "blockSize",
        strokeWidthMultiplier: () => Number(lineWidthInput.value) || 3,
        hudText: (metrics) =>
          `Ellipse axes: ${Math.round(Number(axisXInput.value) * 100)}% × ${Math.round(
            Number(axisYInput.value) * 100
          )}%. Block: ${Math.round(metrics.blockSize)}px.`,
        isHighlighted: ({ cx, cy, metrics }) => {
          const rx = metrics.radius * Number(axisXInput.value || 0.7);
          const ry = metrics.radius * Number(axisYInput.value || 0.7);
          const dx = cx - metrics.centerX;
          const dy = cy - metrics.centerY;
          const k = Math.hypot(dx / rx, dy / ry);
          const approxDist = Math.abs(k - 1) * Math.min(rx, ry);
          return approxDist <= metrics.strokeWidth / 2;
        },
        drawOverlay: ({ grid, metrics, svgNS, settings }) => {
          const rx = metrics.radius * Number(axisXInput.value || 0.7);
          const ry = metrics.radius * Number(axisYInput.value || 0.7);
          const ellipse = document.createElementNS(svgNS, "ellipse");
          ellipse.setAttribute("cx", metrics.centerX);
          ellipse.setAttribute("cy", metrics.centerY);
          ellipse.setAttribute("rx", rx);
          ellipse.setAttribute("ry", ry);
          ellipse.setAttribute("fill", "none");
          ellipse.setAttribute("stroke", "#94a3b8");
          ellipse.setAttribute("stroke-opacity", settings.strokeOpacity);
          ellipse.setAttribute("stroke-width", metrics.strokeWidth);
          grid.appendChild(ellipse);
        },
      });

      axisXInput.addEventListener("input", () => window.dispatchEvent(new Event("resize")));
      axisYInput.addEventListener("input", () => window.dispatchEvent(new Event("resize")));
      lineWidthInput.addEventListener("input", () => window.dispatchEvent(new Event("resize")));
    </script>
  </body>
</html>
